# VASProcar Copyright (C) 2023
# GNU GPL-3.0 license

def execute_python_file(filename: str):
    return exec(open(main_dir + str(filename)).read(), globals())
   
print ("##############################################################")
print ("################## POTCAR file combination: ##################")
print ("##############################################################")
print (" ")

#======================================================================
# Get the input from user =============================================
#======================================================================

print ("##############################################################")
print ("How many POTCAR files do you want to combine? ================")
print ("##############################################################")
nfiles = input (" "); nfiles = int(nfiles)
print (" ")

names = [0]*nfiles

for i in range(nfiles):
    print ("##############################################################")
    print (f'Enter the name of the {i+1}st POTCAR file                    ')
    print ("##############################################################") 
    names[i] = input (" "); names[i] = str(names[i])
    print (" ")

print ("==============================================================")
print ("Calculation to be performed:                                  ")
print ("--------------------------------------------------------------") 
for i in range(nfiles):
    print (f'+ ({names[i]})')
print ("==============================================================")
print (" ")

#=======================================================
new_potcar = open(dir_files + '/output/POTCAR_New', "w")
#=======================================================

#----------------------------------------------------------------------
# Readind POTCAR files ------------------------------------------------
#----------------------------------------------------------------------

for m in range(nfiles):

    name = str(names[m])
    print (".........................................................")
    print (f'Readind {name} ')

    #======================================================================
    # Check if file exists ================================================
    #======================================================================

    try:
        f = open(dir_files + '/' + name)
        f.close()
    except:
        print ("--------------------------------------------------------------")
        print (f'Missing the file {name} in the current directory ')
        print ("Please, fix it! and press ENTER to continue ")
        print ("--------------------------------------------------------------")
        confirmacao = input (" "); confirmacao = str(confirmacao)

    #=========================================
    potcar = open(dir_files + '/' + name, 'r')
    #=========================================

    test = 'nao'

    while (test == 'nao'):             
          #------------------------
          VTemp = potcar.readline()
          new_potcar.write(f'{VTemp}') 
          #---------------------------
          Teste = VTemp.split() 
          #---------------------------------------------
          if (len(Teste) > 0 and Teste[0] == 'End'):
             test = 'sim'
             new_potcar.write(f'\n')      

    #=============
    potcar.close() 
    #=============

#=================
new_potcar.close()
#=================

print (".........................................................")
print (" ")
   
#--------------------------------------------------------------------
print(" ")
print("======================= Completed ==========================")
#--------------------------------------------------------------------

#=======================================================================
# User option to perform another calculation or finished the code ======
#=======================================================================
execute_python_file(filename = '_loop.py')
